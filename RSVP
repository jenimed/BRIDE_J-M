<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>RSVP - Confirmación de Asistencia</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; display: flex; justify-content: center; padding-top: 50px; }
    .container { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 500px; width: 100%; }
    h2 { text-align: center; margin-bottom: 20px; }
    input { width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; }
    button { padding: 10px; font-size: 16px; margin-top: 10px; width: 100%; cursor: pointer; }
    .pase-button { padding: 5px 10px; margin: 5px; cursor: pointer; }
    #result p { margin: 5px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h2>RSVP - Confirmación de Asistencia</h2>
    <input id="codigo" type="text" placeholder="Ingrese su código único">
    <button onclick="consultarInvitado()">Consultar</button>
    <div id="result"></div>
  </div>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbyYUDSfseFsQYqh1q_dsaDF_uRDF4XmtniJEHIW7GkL1Ivdoujv0Bc3avWWlea-s_Jw0g/exec";

    function consultarInvitado() {
      const codigo = document.getElementById("codigo").value.trim();
      if (!codigo) {
        alert("Por favor ingrese su código.");
        return;
      }

      fetch(`${apiUrl}?codigo=${codigo}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            document.getElementById("result").innerHTML = `<p style="color:red">${data.error}</p>`;
          } else {
            let confirmButtons = '';
            for (let i = 1; i <= data.pases; i++) {
              confirmButtons += `<button class="pase-button" onclick="confirmar('${codigo}', ${i})">Confirmar pase ${i}</button>`;
            }

            document.getElementById("result").innerHTML = `
              <p><strong>Nombre:</strong> ${data.nombre}</p>
              <p><strong>No. de pases:</strong> ${data.pases}</p>
              <p><strong>Estado:</strong> ${data.estado || "Pendiente"}</p>
              ${confirmButtons}
            `;
          }
        })
        .catch(err => {
          document.getElementById("result").innerHTML = `<p style="color:red">Error al consultar el invitado.</p>`;
          console.error(err);
        });
    }

    function confirmar(codigo, pase) {
      const estado = `Confirmado pase ${pase}`;

      fetch(apiUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ codigo, estado })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert(`Pase ${pase} confirmado exitosamente!`);
          consultarInvitado(); // refresca la info
        } else {
          alert("Error al confirmar el pase.");
        }
      })
      .catch(err => {
        alert("Error de conexión.");
        console.error(err);
      });
    }
  </script>
</body>
</html>
